name: PR E2E Checks

on:
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]
jobs:
  pr-e2e-precheck:
    runs-on: ubuntu-latest
    steps:
      - run: echo "github.base_ref = ${{ github.base_ref }}"
      - run: echo "github.head_ref = ${{ github.head_ref }}"
      - run: echo "github.event.name = ${{ github.event_name }}"
      - run: echo "github.event.pull_request.draft = ${{ github.event.pull_request.draft }}"
  
  pr-e2e-check:
    # Run e2e tests:
    # - on pull request changed from draft to ready-for-review
    # - on commits to:
    #   * PRs to master
    #   * PRs to dev that are not draft
    #   * PRs to dev on branches created by dependabot
    if: "${{
      github.event_name == 'pull_request' && (
        github.event.action == 'review_requested' ||
        github.base_ref == 'master' ||
        (github.base_ref == 'dev' && (
          github.event.pull_request.draft == false ||
          startsWith(github.head_ref, 'dependabot/')
        ))
      )
      }}"
    uses: ./.github/workflows/node-ci.yml
    with:
      e2e: true
    secrets: inherit
